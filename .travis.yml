language: python

services:
  - docker

python:
  - "3.7"

before_install:
  - pip install -r deployment/requirements.txt
  - export TAG=${TRAVIS_BRANCH}-${TRAVIS_COMMIT:0:7}
  - ansible-playbook deployment/docker-build-tag.yaml -vv
  - docker images

install:
  - echo 0

script:
  - echo 0

deploy:
  provider: script
  script: bash deployment/ci_deployment.sh
  on:
    repo: StateArchivesOfNorthCarolina/ratom-server
    all_branches: true
    condition: $TRAVIS_BRANCH =~ ^(develop|master)$